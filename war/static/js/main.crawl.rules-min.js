function refreshCrawlRules(){if(crawlRules.v.rulesVerId!=null){crawlRules.fn.changeRulesVer(crawlRules.v.rulesVerId,true)}}var crawlRules={v:{jsonData:null,jsonDataVer:null,siteJson:null,crawlRulesForm:"crawlRulesForm",tableId:"crawlRulesTable",rulesVerId:null,rulesVerIdByEdit:null,pageLabelIndex:0,commonLabelIndex:0},fn:{init:function(){crawlRules.v.jsonData=null;crawlRules.v.rulesVerId=null;crawlRules.v.pageLabelIndex=0;crawlRules.v.commonLabelIndex=0;crawlRules.v.rulesVerIdByEdit=null;poshytip(".tooltip");$("#crawlRulesTable #accordion").accordion({heightStyle:"content",activate:function(f,g){var e=g.newHeader.text();e=e.substring(0,1);if(e=="1"){var d=$("#pageLabelTabel #all")[0];if(d){d.checked=false;crawlRules.fn.selectAll(d,"pageLabelTabel","rules");$("#"+crawlRules.v.crawlRulesForm).find("#labelType").val(1)}}else{var d=$("#crawlLabelTabel #all")[0];if(d){d.checked=false;crawlRules.fn.selectAll(d,"crawlLabelTabel","rules");$("#"+crawlRules.v.crawlRulesForm).find("#labelType").val(2)}}}});fillSite(pageRules.v.formId,"nextLinkMatchRules",true);$("#"+pageRules.v.formId).find("select[id=nextLinkMatchRules]").find("option[value='"+pageRules.v.siteId+"']").remove();fillSite(crawlRules.v.crawlRulesForm,"nestedSiteId",true);$("#"+crawlRules.v.crawlRulesForm).find("select[id=nestedSiteId]").find("option[value='"+pageRules.v.siteId+"']").remove();fillCustomInter("4",crawlRules.v.crawlRulesForm,"filterInter",true);var a=function(){fillCustomPlugin("3",crawlRules.v.crawlRulesForm,"fileSavePluginId")};fillCustomPlugin("2",crawlRules.v.crawlRulesForm,"filterPlugin",true,null,a);fillHttpRequest(crawlRules.v.crawlRulesForm,"httpRequestId",true);fillDataJavascript(crawlRules.v.crawlRulesForm,"dataJavascriptId",true,"sync_count");$("#"+crawlRules.v.crawlRulesForm).find("#absoluteUrlRegex").val("(?:href|src)=[\"'](.*?)[\"']");$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginRegex").val("<\\s*img[^<]+src=[\"'](.*?)[\"'][^<]*?>");var c=crawlRules.v.siteJson;for(var b in c){if(isNaN(b)){continue}if(c[b]["id"]==pageRules.v.siteId){$("#"+crawlRules.v.tableId).find("#crawlUrl").val(c[b]["url"]);if(c[b]["isLoop"]=="Y"&&c[b]["isMerge"]=="Y"){$("#"+crawlRules.v.tableId).find(".mergeRules").css("display","")}break}}crawlRules.fn.queryVer();$("#"+crawlRules.v.tableId).find("#rulesVersion").find("#sortable").sortable({handle:".ui-icon-arrow-4",update:function(d,e){crawlRules.fn.sortRulesVer(e.item)}}).disableSelection();$("#"+crawlRules.v.tableId).find("#crawlLabelTabel").find("#sortable").sortable({handle:".ui-icon-arrow-4",update:function(d,e){crawlRules.fn.sortRules("1",e.item)}});$("#"+crawlRules.v.tableId).find("#pageLabelTabel").find("#sortable").sortable({handle:".ui-icon-arrow-4",update:function(d,e){crawlRules.fn.sortRules("2",e.item)}});$("#"+crawlRules.v.tableId).find("#sort_table tbody").sortable({handle:".ui-icon-arrow-4"});$("#"+crawlRules.v.tableId).find("#sort_table").find(".simplehighlight").hover(function(){$(this).addClass("datahighlight")},function(){$(this).removeClass("datahighlight")});$("#"+crawlRules.v.crawlRulesForm).find("input[type=radio][name=selectType]").click(function(){var d=$(this).val();if(d=="@ATTR"){$("#"+crawlRules.v.tableId).find("#selectAttr").show()}else{$("#"+crawlRules.v.tableId).find("#selectAttr").hide()}})},queryVer:function(){$("#"+crawlRules.v.tableId).find("#rulesVersion li").remove();jsonrpc.crawlRulesVerService.query(function(result,exception,profile){if(exception){removeLoading($("#"+pageRules.v.formId));return}var rulesVerId=null;var data=eval(result);crawlRules.v.jsonDataVer=data;for(var i in data){if(isNaN(i)){continue}var id=data[i]["id"];var versionName=data[i]["name"];crawlRules.fn.addRulesVer(id,versionName);if(rulesVerId==null){rulesVerId=id}}$("#"+crawlRules.v.tableId).find("#rulesVersion li").hover(function(){$(this).addClass("datahighlight")},function(){$(this).removeClass("datahighlight")});crawlRules.fn.changeRulesVer(rulesVerId)},pageRules.v.webCrawlerId,pageRules.v.siteId)},query:function(rulesVerId){$("#crawlLabelTabel").find("#sortable").empty();$("#pageLabelTabel").find("#sortable").empty();jsonrpc.crawlRulesService.query(function(result,exception,profile){if(exception){removeLoading($("#"+pageRules.v.formId));return}var data=result;data=eval(data);crawlRules.v.jsonData=data;crawlRules.v.pageLabelIndex=0;crawlRules.v.commonLabelIndex=0;$("#"+pageRules.v.formId).find("#nextLinkExpress").val("");$("#"+pageRules.v.formId).find("#nextPageMaxTimes").val("");$("#"+pageRules.v.formId).find("#nextLinkMatchRules").val("");for(var i in data){if(isNaN(i)){continue}var id=data[i]["id"];var name=data[i]["name"];var startString=data[i]["startString"];var endString=data[i]["endString"];var labelType=data[i]["labelType"];var isDataOrigin=data[i]["isDataOrigin"];var dataOrigin=data[i]["dataOrigin"];if(labelType=="2"){if(name=="SYS_VAR_NEXTLINKEXPRESS"){$("#"+pageRules.v.formId).find("#nextLinkExpress").val(data[i]["defaultValue"]);continue}else{if(name=="SYS_VAR_NEXTPAGEMAXTIMES"){$("#"+pageRules.v.formId).find("#nextPageMaxTimes").val(data[i]["defaultValue"]);continue}else{if(name=="SYS_VAR_NEXTLINKMATCHRULES"){$("#"+pageRules.v.formId).find("#nextLinkMatchRules").val(data[i]["defaultValue"]);continue}}}}if(isDataOrigin=="true"&&(dataOrigin=="#DATAORIGIN_LABEL"||dataOrigin=="#DATAORIGIN_HEADER"||dataOrigin=="#DATAORIGIN_COOKIE")){var valueFromLabel=data[i]["valueFromLabel"]}crawlRules.fn.addRow(id,name,startString,endString,labelType,isDataOrigin,dataOrigin,valueFromLabel)}removeLoading($("#"+pageRules.v.formId))},pageRules.v.webCrawlerId,pageRules.v.siteId,rulesVerId)},create:function(){var v=$("#"+crawlRules.v.crawlRulesForm).find("#name").val();var ad=getCheckbox(crawlRules.v.crawlRulesForm,"isAbsolute");var S=$("#"+crawlRules.v.crawlRulesForm).find("#absoluteUrlRegex").val();var R=$("#"+crawlRules.v.crawlRulesForm).find("#absoluteUrlBase").val();var z=getCheckbox(crawlRules.v.crawlRulesForm,"isCantNull");var f=getCheckbox(crawlRules.v.crawlRulesForm,"unique");var s=$("#"+crawlRules.v.crawlRulesForm).find("#labelType").val();var O=getCheckbox(crawlRules.v.crawlRulesForm,"isOffset");var D=getCheckbox(crawlRules.v.crawlRulesForm,"isRegex");var ab=$("#"+crawlRules.v.crawlRulesForm).find("#mergeRules").val();var X=getCheckbox(crawlRules.v.crawlRulesForm,"isSingleMatch");var N=$("#"+crawlRules.v.crawlRulesForm).find("#textComposition").val();var af=$("#"+crawlRules.v.crawlRulesForm).find("#regexFilter").val();var h=$("#"+crawlRules.v.crawlRulesForm).find("#dataJavascriptId").val();var u=$("#"+crawlRules.v.crawlRulesForm).find("#textLen").val();var b=$("#"+crawlRules.v.crawlRulesForm).find("#functionExpression").val();var n=getCheckbox(crawlRules.v.crawlRulesForm,"isPublic");var ae=getCheckbox(crawlRules.v.crawlRulesForm,"isHtmlPreprocess");var V=getRadio(crawlRules.v.crawlRulesForm,"selectType");var C=getRadio(crawlRules.v.crawlRulesForm,"searchMode");var q=$("#"+crawlRules.v.crawlRulesForm).find("#selectExpress").val();var l=$("#"+crawlRules.v.crawlRulesForm).find("#selectAttr").val();var I=$("#"+crawlRules.v.crawlRulesForm).find("#startString").val();var K=$("#"+crawlRules.v.crawlRulesForm).find("#endString").val();var p=$("#"+crawlRules.v.crawlRulesForm).find("#searchRegex").val();var G=$("#"+crawlRules.v.crawlRulesForm).find("#labelCombination").val();var e=$("#"+crawlRules.v.crawlRulesForm).find("select[name=autoProperty]").val();e=parseInt(e);var E=getCheckbox(crawlRules.v.crawlRulesForm,"isDownload");var L=$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginId").val();var Z=$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginRegex").val();var g=$("#"+crawlRules.v.crawlRulesForm).find("#fileSaveSubDir").val();var j=$("#"+crawlRules.v.crawlRulesForm).find("#filterInter").val();var r=$("#"+crawlRules.v.crawlRulesForm).find("#filterPlugin").val();var Q=getCheckbox(crawlRules.v.crawlRulesForm,"isTemp");var M=getCheckbox(crawlRules.v.crawlRulesForm,"isLoop");var d=getCheckbox(crawlRules.v.crawlRulesForm,"loopSplit");var B=getCheckbox(crawlRules.v.crawlRulesForm,"isStartPosition");var T=getCheckbox(crawlRules.v.crawlRulesForm,"isFetchUrl");var a=$("#"+crawlRules.v.crawlRulesForm).find("#httpRequestId").val();var o=$("#"+crawlRules.v.crawlRulesForm).find("#fetchUrlHttpRequestParams").val();var A=getCheckbox(crawlRules.v.crawlRulesForm,"isConvertEncoding");var aa=getCheckbox(crawlRules.v.crawlRulesForm,"isDataOrigin");var P=$("#"+crawlRules.v.crawlRulesForm).find("#dataOrigin").val();var m=$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabel").val();var y=crawlRules.fn.getSortIndex();var U=crawlRules.fn.getCheckBox2Json("excludeHtmlTags");var i=crawlRules.fn.getTextJson("mustContainTextDiv");var ac=crawlRules.fn.getTextJson("cantContainTextDiv");var x=crawlRules.fn.getTextJson("excludeTextDiv");var c=crawlRules.fn.getTextJson("replaceTextDiv");var W=getCheckbox(crawlRules.v.crawlRulesForm,"isRegexMustContainText");var J=getCheckbox(crawlRules.v.crawlRulesForm,"isRegexCantContainText");var k=getCheckbox(crawlRules.v.crawlRulesForm,"isRegexExcludeText");var Y=getCheckbox(crawlRules.v.crawlRulesForm,"isRegexReplaceText");var t=getCheckbox(crawlRules.v.crawlRulesForm,"isDefaultValue");var w=$("#"+crawlRules.v.crawlRulesForm).find("#defaultValue").val();var F=getCheckbox(crawlRules.v.crawlRulesForm,"fetchUrlAutoExtract");var H="";if(aa!="true"){P="";m=""}else{if(P!="#DATAORIGIN_LABEL"&&P!="#DATAORIGIN_HEADER"&&P!="#DATAORIGIN_COOKIE"){m=""}}if(A=="true"){H=crawlRules.fn.getCheckBox2Json("convertEncode")}if(E!="true"){L=null;Z="";g=""}if(C=="regex"){I="";K="";q="";G="";e=""}else{if(C=="string"){p="";q="";G="";e=""}else{if(C=="xpath"||C=="csspath"||C=="jsonpath"){p="";I="";K="";G="";e=""}else{if(C=="label"){p="";I="";K="";q="";e=""}else{if(C=="auto"){p="";I="";K="";q=""}}}}}if(t!="true"){w=""}showLoading($("#"+pageRules.v.formId));jsonrpc.crawlRulesService.create(function(ag,ah,ai){if(ah){removeLoading($("#"+pageRules.v.formId));return}var aj=ag;if(isNaN(aj)){showInfo(nc.i18n("res.create.failure"));removeLoading($("#"+pageRules.v.formId));return}crawlRules.fn.createJson(aj);crawlRules.fn.show(aj);if(crawlRules.v.rulesVerId==null||crawlRules.v.rulesVerId===""){crawlRules.fn.queryVer()}else{removeLoading($("#"+pageRules.v.formId))}},{javaClass:"com.soso.web.jsonrpc.bo.CrawlRulesBo",webCrawlerId:pageRules.v.webCrawlerId,siteId:pageRules.v.siteId,name:v,defaultValue:w,isAbsolute:ad,isCantNull:z,labelType:s,isOffset:O,startString:I,endString:K,mergeRules:ab,excludeHtmlTags:U,mustContainText:i,cantContainText:ac,excludeText:x,replaceText:c,regexFilter:af,textLen:u,functionExpression:b,searchRegex:p,labelCombination:G,searchMode:C,filterSort:y,valueFromLabel:m,isPublic:n,filterInterId:j,filterPluginId:r,isDownload:E,fileSavePluginId:L,isTemp:Q,isLoop:M,isStartPosition:B,isConvertEncoding:A,convertEncode:H,isRegexMustContainText:W,isRegexCantContainText:J,isRegexExcludeText:k,isRegexReplaceText:Y,isDefaultValue:t,fileSavePluginRegex:Z,fileSaveSubDir:g,absoluteUrlRegex:S,absoluteUrlBase:R,isDataOrigin:aa,dataOrigin:P,dataJavascriptId:h,isSingleMatch:X,textComposition:N,isHtmlPreprocess:ae,loopSplit:d,rulesVerId:crawlRules.v.rulesVerId,selectExpress:q,selectType:V,selectAttr:l,isFetchUrl:T,fetchUrlHttpRequestId:a,fetchUrlHttpRequestParams:o,unique:f,autoProperty:e,fetchUrlAutoExtract:F})},removeAll:function(){var d="";var e=$(":checkbox[name=rules]");for(var b=0,a=e.length;b<a;b++){if(e[b].checked){if(d==""){d=e[b].value}else{d+=","+e[b].value}}}if(d==null||d==""){showInfo(nc.i18n("res.select.multi"));return}crawlRules.fn.remove(d)},remove:function(a){if(!confirm(nc.i18n("res.remove.confirm"))){return}a=""+a;showLoading($("#"+pageRules.v.formId));jsonrpc.crawlRulesService.remove(function(b,c,d){removeLoading($("#"+pageRules.v.formId));if(c){return}var e=b;if(!e){showInfo(nc.i18n("res.remove.failure"));return}crawlRules.fn.changeRulesVer(crawlRules.v.rulesVerId,true);showInfo(nc.i18n("res.remove.success"))},pageRules.v.webCrawlerId,pageRules.v.siteId,crawlRules.v.rulesVerId,a)},editInClickName:function(a){$("#"+crawlRules.v.tableId+" input[type=checkbox][name=rules]").each(function(){this.checked=false;if(this.value==a){this.checked=true}});crawlRules.fn.edit(a)},edit:function(f){if(f==null||f.length==0){showInfo(nc.i18n("res.select"));return}var d=crawlRules.v.jsonData;for(var c in d){if(isNaN(c)){continue}if(d[c]["id"]!=f){continue}$("#"+crawlRules.v.crawlRulesForm).find("#id").val(d[c]["id"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isHtmlPreprocess",d[c]["isHtmlPreprocess"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isAbsolute",d[c]["isAbsolute"]);crawlRules.fn.changeOption($("#"+crawlRules.v.crawlRulesForm).find("#isAbsolute").get(0));if(d[c]["isAbsolute"]=="true"){$("#"+crawlRules.v.crawlRulesForm).find("#absoluteUrlRegex").val(d[c]["absoluteUrlRegex"]);$("#"+crawlRules.v.crawlRulesForm).find("#absoluteUrlBase").val(d[c]["absoluteUrlBase"])}else{$("#"+crawlRules.v.crawlRulesForm).find("#absoluteUrlRegex").val("(?:href|src)=[\"'](.*?)[\"']");$("#"+crawlRules.v.crawlRulesForm).find("#absoluteUrlBase").val("")}selectCheckbox(crawlRules.v.crawlRulesForm,"isOffset",d[c]["isOffset"]);crawlRules.fn.changeOffset(d[c]["isOffset"],false);$("#"+crawlRules.v.crawlRulesForm).find("#filterInter").val(d[c]["filterInterId"]);$("#"+crawlRules.v.crawlRulesForm).find("#filterPlugin").val(d[c]["filterPluginId"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isDownload",d[c]["isDownload"]);crawlRules.fn.changeOption($("#"+crawlRules.v.crawlRulesForm).find("#isDownload").get(0));if(d[c]["isDownload"]=="true"){var a=$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginId option[value='"+d[c]["fileSavePluginId"]+"']").length;if(a<1){$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginId").append("<option value=''/></option>")}$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginId").val(d[c]["fileSavePluginId"]);$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginRegex").val(d[c]["fileSavePluginRegex"]);$("#"+crawlRules.v.crawlRulesForm).find("#fileSaveSubDir").val(d[c]["fileSaveSubDir"])}else{$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginId").val("");$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginRegex").val("<\\s*img[^<]+src=[\"'](.*?)[\"'][^<]*?>");$("#"+crawlRules.v.crawlRulesForm).find("#fileSaveSubDir").val("")}selectCheckbox(crawlRules.v.crawlRulesForm,"isDefaultValue",d[c]["isDefaultValue"]);crawlRules.fn.changeOption($("#"+crawlRules.v.crawlRulesForm).find("#isDefaultValue").get(0));var e=false;$("#"+crawlRules.v.crawlRulesForm).find("#defaultValueSel option").each(function(){if(d[c]["defaultValue"]==this.value){e=true;this.selected=true}});if(!e){$("#"+crawlRules.v.crawlRulesForm).find("#defaultValueSel").val("");crawlRules.fn.defaultValueSel("");$("#"+crawlRules.v.crawlRulesForm).find("#defaultValue").val(d[c]["defaultValue"])}else{crawlRules.fn.defaultValueSel(d[c]["defaultValue"])}var b=d[c]["labelType"];if(b==null||b==""){b="1"}$("#"+crawlRules.v.crawlRulesForm).find("#labelType").val(b);selectCheckbox(crawlRules.v.crawlRulesForm,"isFetchUrl",d[c]["isFetchUrl"]);crawlRules.fn.changeOption($("#"+crawlRules.v.crawlRulesForm).find("#isFetchUrl").get(0));$("#"+crawlRules.v.crawlRulesForm).find("#httpRequestId").val(d[c]["fetchUrlHttpRequestId"]);$("#"+crawlRules.v.crawlRulesForm).find("#fetchUrlHttpRequestParams").val(d[c]["fetchUrlHttpRequestParams"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isLoop",d[c]["isLoop"]);$("#"+crawlRules.v.crawlRulesForm).find("#loopSplit").val(d[c]["loopSplit"]);$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabel").val(d[c]["valueFromLabel"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isDataOrigin",d[c]["isDataOrigin"]);crawlRules.fn.changeOption($("#"+crawlRules.v.crawlRulesForm).find("#isDataOrigin").get(0));$("#"+crawlRules.v.crawlRulesForm).find("#dataOrigin").val(d[c]["dataOrigin"]);crawlRules.fn.changeDataOrigin(d[c]["dataOrigin"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isConvertEncoding",d[c]["isConvertEncoding"]);crawlRules.fn.changeOption($("#"+crawlRules.v.crawlRulesForm).find("#isConvertEncoding").get(0));$("#"+crawlRules.v.crawlRulesForm).find("#name").val(d[c]["name"]);$("#"+crawlRules.v.crawlRulesForm).find("#mergeRules").val(d[c]["mergeRules"]);$("#"+crawlRules.v.crawlRulesForm).find("#textComposition").val(d[c]["textComposition"]);$("#"+crawlRules.v.crawlRulesForm).find("#regexFilter").val(d[c]["regexFilter"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isSingleMatch",d[c]["isSingleMatch"]);$("#"+crawlRules.v.crawlRulesForm).find("#dataJavascriptId").val(d[c]["dataJavascriptId"]);$("#"+crawlRules.v.crawlRulesForm).find("#textLen").val(d[c]["textLen"]);$("#"+crawlRules.v.crawlRulesForm).find("#functionExpression").val(d[c]["functionExpression"]);selectRadio(crawlRules.v.crawlRulesForm,"selectType",d[c]["selectType"]);selectRadio(crawlRules.v.crawlRulesForm,"searchMode",d[c]["searchMode"]);$("#"+crawlRules.v.crawlRulesForm).find("input[type=radio][name=selectType]:checked").click();$("#"+crawlRules.v.crawlRulesForm).find("#selectExpress").val(d[c]["selectExpress"]);$("#"+crawlRules.v.crawlRulesForm).find("#selectAttr").val(d[c]["selectAttr"]);$("#"+crawlRules.v.crawlRulesForm).find("select[name=autoProperty]").val(d[c]["autoProperty"]);$("#"+crawlRules.v.crawlRulesForm).find("#labelCombination").val(d[c]["labelCombination"]);$("#"+crawlRules.v.crawlRulesForm).find("#searchRegex").val(d[c]["searchRegex"]);$("#"+crawlRules.v.crawlRulesForm).find("#startString").val(d[c]["startString"]);$("#"+crawlRules.v.crawlRulesForm).find("#endString").val(d[c]["endString"]);crawlRules.fn.changeHtmlPreprocess(d[c]["isHtmlPreprocess"],false);crawlRules.fn.initCheckboxByJson(d[c]["convertEncode"],"convertEncode");crawlRules.fn.initExcludeHtmlTags(d[c]["excludeHtmlTags"]);crawlRules.fn.initTextLabels("mustContainText",d[c]["mustContainText"]);crawlRules.fn.initTextLabels("cantContainText",d[c]["cantContainText"]);crawlRules.fn.initTextLabels("excludeText",d[c]["excludeText"]);crawlRules.fn.initTextLabels("replaceText",d[c]["replaceText"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isRegexMustContainText",d[c]["isRegexMustContainText"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isRegexCantContainText",d[c]["isRegexCantContainText"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isRegexExcludeText",d[c]["isRegexExcludeText"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isRegexReplaceText",d[c]["isRegexReplaceText"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isCantNull",d[c]["isCantNull"]);selectCheckbox(crawlRules.v.crawlRulesForm,"unique",d[c]["unique"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isTemp",d[c]["isTemp"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isPublic",d[c]["isPublic"]);selectCheckbox(crawlRules.v.crawlRulesForm,"isStartPosition",d[c]["isStartPosition"]);selectCheckbox(crawlRules.v.crawlRulesForm,"fetchUrlAutoExtract",d[c]["fetchUrlAutoExtract"]);crawlRules.fn.changeSearchMode();crawlRules.fn.initTable();crawlRules.fn.sortTable(d[c]["filterSort"]);return}},update:function(){var M=$("#"+crawlRules.v.crawlRulesForm).find("#id").val();if(M==null||M.length==0){showInfo(nc.i18n("res.select"));return}var v=$("#"+crawlRules.v.crawlRulesForm).find("#name").val();var w=$("#"+crawlRules.v.crawlRulesForm).find("#defaultValue").val();var ad=getCheckbox(crawlRules.v.crawlRulesForm,"isAbsolute");var S=$("#"+crawlRules.v.crawlRulesForm).find("#absoluteUrlRegex").val();var R=$("#"+crawlRules.v.crawlRulesForm).find("#absoluteUrlBase").val();var z=getCheckbox(crawlRules.v.crawlRulesForm,"isCantNull");var f=getCheckbox(crawlRules.v.crawlRulesForm,"unique");var s=$("#"+crawlRules.v.crawlRulesForm).find("#labelType").val();var O=getCheckbox(crawlRules.v.crawlRulesForm,"isOffset");var n=getCheckbox(crawlRules.v.crawlRulesForm,"isPublic");var ae=getCheckbox(crawlRules.v.crawlRulesForm,"isHtmlPreprocess");var ab=$("#"+crawlRules.v.crawlRulesForm).find("#mergeRules").val();var N=$("#"+crawlRules.v.crawlRulesForm).find("#textComposition").val();var af=$("#"+crawlRules.v.crawlRulesForm).find("#regexFilter").val();var X=getCheckbox(crawlRules.v.crawlRulesForm,"isSingleMatch");var h=$("#"+crawlRules.v.crawlRulesForm).find("#dataJavascriptId").val();var u=$("#"+crawlRules.v.crawlRulesForm).find("#textLen").val();var b=$("#"+crawlRules.v.crawlRulesForm).find("#functionExpression").val();var V=getRadio(crawlRules.v.crawlRulesForm,"selectType");var C=getRadio(crawlRules.v.crawlRulesForm,"searchMode");var q=$("#"+crawlRules.v.crawlRulesForm).find("#selectExpress").val();var l=$("#"+crawlRules.v.crawlRulesForm).find("#selectAttr").val();var H=$("#"+crawlRules.v.crawlRulesForm).find("#startString").val();var J=$("#"+crawlRules.v.crawlRulesForm).find("#endString").val();var p=$("#"+crawlRules.v.crawlRulesForm).find("#searchRegex").val();var F=$("#"+crawlRules.v.crawlRulesForm).find("#labelCombination").val();var e=$("#"+crawlRules.v.crawlRulesForm).find("select[name=autoProperty]").val();e=parseInt(e);var D=getCheckbox(crawlRules.v.crawlRulesForm,"isDownload");var K=$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginId").val();var Z=$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginRegex").val();var g=$("#"+crawlRules.v.crawlRulesForm).find("#fileSaveSubDir").val();var j=$("#"+crawlRules.v.crawlRulesForm).find("#filterInter").val();var r=$("#"+crawlRules.v.crawlRulesForm).find("#filterPlugin").val();var Q=getCheckbox(crawlRules.v.crawlRulesForm,"isTemp");var m=$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabel").val();var L=getCheckbox(crawlRules.v.crawlRulesForm,"isLoop");var d=$("#"+crawlRules.v.crawlRulesForm).find("#loopSplit").val();var B=getCheckbox(crawlRules.v.crawlRulesForm,"isStartPosition");var aa=getCheckbox(crawlRules.v.crawlRulesForm,"isDataOrigin");var P=$("#"+crawlRules.v.crawlRulesForm).find("#dataOrigin").val();var T=getCheckbox(crawlRules.v.crawlRulesForm,"isFetchUrl");var a=$("#"+crawlRules.v.crawlRulesForm).find("#httpRequestId").val();var o=$("#"+crawlRules.v.crawlRulesForm).find("#fetchUrlHttpRequestParams").val();var A=getCheckbox(crawlRules.v.crawlRulesForm,"isConvertEncoding");var y=crawlRules.fn.getSortIndex();var U=crawlRules.fn.getCheckBox2Json("excludeHtmlTags");var i=crawlRules.fn.getTextJson("mustContainTextDiv");var ac=crawlRules.fn.getTextJson("cantContainTextDiv");var x=crawlRules.fn.getTextJson("excludeTextDiv");var c=crawlRules.fn.getTextJson("replaceTextDiv");var W=getCheckbox(crawlRules.v.crawlRulesForm,"isRegexMustContainText");var I=getCheckbox(crawlRules.v.crawlRulesForm,"isRegexCantContainText");var k=getCheckbox(crawlRules.v.crawlRulesForm,"isRegexExcludeText");var Y=getCheckbox(crawlRules.v.crawlRulesForm,"isRegexReplaceText");var t=getCheckbox(crawlRules.v.crawlRulesForm,"isDefaultValue");var w=$("#"+crawlRules.v.crawlRulesForm).find("#defaultValue").val();var E=getCheckbox(crawlRules.v.crawlRulesForm,"fetchUrlAutoExtract");var G="";if(A=="true"){G=crawlRules.fn.getCheckBox2Json("convertEncode")}if(aa!="true"){P="";m=""}else{if(P!="#DATAORIGIN_LABEL"&&P!="#DATAORIGIN_HEADER"&&P!="#DATAORIGIN_COOKIE"){m=""}}if(t!="true"){w=""}if(D!="true"){K=null;Z="";g=""}if(C=="regex"){H="";J="";q="";F="";e=""}else{if(C=="string"){p="";q="";F="";e=""}else{if(C=="xpath"||C=="csspath"||C=="jsonpath"){p="";H="";J="";F="";e=""}else{if(C=="label"){p="";H="";J="";q="";e=""}else{if(C=="auto"){p="";H="";J="";q=""}}}}}showLoading($("#"+pageRules.v.formId));jsonrpc.crawlRulesService.update(function(ag,ah,ai){removeLoading($("#"+pageRules.v.formId));if(ah){return}var aj=ag;if(aj){crawlRules.fn.updateJson();crawlRules.fn.updateRow(M,v);showInfo(nc.i18n("res.update.success"))}else{showInfo(nc.i18n("res.update.failure"))}},{javaClass:"com.soso.web.jsonrpc.bo.CrawlRulesBo",id:M,webCrawlerId:pageRules.v.webCrawlerId,siteId:pageRules.v.siteId,name:v,defaultValue:w,isAbsolute:ad,isCantNull:z,labelType:s,isOffset:O,startString:H,endString:J,mergeRules:ab,excludeHtmlTags:U,mustContainText:i,cantContainText:ac,excludeText:x,replaceText:c,regexFilter:af,textLen:u,functionExpression:b,searchRegex:p,labelCombination:F,searchMode:C,filterSort:y,valueFromLabel:m,isPublic:n,filterInterId:j,filterPluginId:r,isDownload:D,fileSavePluginId:K,isTemp:Q,isLoop:L,isStartPosition:B,isConvertEncoding:A,convertEncode:G,isRegexMustContainText:W,isRegexCantContainText:I,isRegexExcludeText:k,isRegexReplaceText:Y,isDefaultValue:t,fileSavePluginRegex:Z,fileSaveSubDir:g,absoluteUrlRegex:S,absoluteUrlBase:R,isDataOrigin:aa,dataOrigin:P,dataJavascriptId:h,isSingleMatch:X,textComposition:N,isHtmlPreprocess:ae,loopSplit:d,rulesVerId:crawlRules.v.rulesVerId,selectExpress:q,selectType:V,selectAttr:l,isFetchUrl:T,fetchUrlHttpRequestId:a,fetchUrlHttpRequestParams:o,unique:f,autoProperty:e,fetchUrlAutoExtract:E})},updateJson:function(){var c=$("#"+crawlRules.v.crawlRulesForm).find("#id").val();var b=crawlRules.v.jsonData;for(var a in b){if(isNaN(a)){continue}if(b[a]["id"]!=c){continue}b[a]=crawlRules.fn.getJsonData(c)}},createJson:function(c){var b=crawlRules.v.jsonData;if(b==null){b=new Array()}var a=crawlRules.fn.getJsonData(c);b.push(a);crawlRules.v.jsonData=b},getJsonData:function(w){var v=getRadio(crawlRules.v.crawlRulesForm,"selectType");var C=getRadio(crawlRules.v.crawlRulesForm,"searchMode");var e=$("#"+crawlRules.v.crawlRulesForm).find("#selectAttr").val();var o=$("#"+crawlRules.v.crawlRulesForm).find("#selectExpress").val();var s=$("#"+crawlRules.v.crawlRulesForm).find("#startString").val();var a=$("#"+crawlRules.v.crawlRulesForm).find("#endString").val();var A=$("#"+crawlRules.v.crawlRulesForm).find("#searchRegex").val();var D=$("#"+crawlRules.v.crawlRulesForm).find("#labelCombination").val();var E=$("#"+crawlRules.v.crawlRulesForm).find("select[name=autoProperty]").val();E=parseInt(E);var x=getCheckbox(crawlRules.v.crawlRulesForm,"isAbsolute");var r=$("#"+crawlRules.v.crawlRulesForm).find("#absoluteUrlRegex").val();var i=$("#"+crawlRules.v.crawlRulesForm).find("#absoluteUrlBase").val();var F=getCheckbox(crawlRules.v.crawlRulesForm,"isDownload");var G=$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginId").val();var p=$("#"+crawlRules.v.crawlRulesForm).find("#fileSavePluginRegex").val();var d=$("#"+crawlRules.v.crawlRulesForm).find("#fileSaveSubDir").val();var u=getCheckbox(crawlRules.v.crawlRulesForm,"isDataOrigin");var f=$("#"+crawlRules.v.crawlRulesForm).find("#dataOrigin").val();var c=$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabel").val();var l=getCheckbox(crawlRules.v.crawlRulesForm,"isConvertEncoding");var h=getCheckbox(crawlRules.v.crawlRulesForm,"isRegexMustContainText");var B=getCheckbox(crawlRules.v.crawlRulesForm,"isRegexCantContainText");var k=getCheckbox(crawlRules.v.crawlRulesForm,"isRegexExcludeText");var j=getCheckbox(crawlRules.v.crawlRulesForm,"isRegexReplaceText");var q=getCheckbox(crawlRules.v.crawlRulesForm,"isDefaultValue");var y=$("#"+crawlRules.v.crawlRulesForm).find("#defaultValue").val();var z="";if(l=="true"){z=crawlRules.fn.getCheckBox2Json("convertEncode")}if(C=="regex"){s="";a="";o="";D="";E=""}else{if(C=="string"){A="";o="";D="";E=""}else{if(C=="xpath"||C=="csspath"||C=="jsonpath"){A="";s="";a="";D="";E=""}else{if(C=="label"){A="";s="";a="";o="";E=""}else{if(C=="auto"){A="";s="";a="";o=""}}}}}if(u!="true"){f="";c=""}if(q!="true"){y=""}if(F!="true"){G=null;p="";d=""}if(x!="true"){r="";i=""}var t=crawlRules.fn.getTextJson("mustContainTextDiv");if(t){t=JSON.parse(t)}var b=crawlRules.fn.getTextJson("cantContainTextDiv");if(b){b=JSON.parse(b)}var n=crawlRules.fn.getTextJson("excludeTextDiv");if(n){n=JSON.parse(n)}var m=crawlRules.fn.getTextJson("replaceTextDiv");if(m){m=JSON.parse(m)}var g={id:w,selectType:v,searchMode:C,startString:s,endString:a,searchRegex:A,selectExpress:o,autoProperty:E,labelCombination:D,isDownload:F,fileSavePluginId:G,fileSavePluginRegex:p,fileSaveSubDir:d,valueFromLabel:c,filterSort:crawlRules.fn.getSortIndex(),excludeHtmlTags:crawlRules.fn.getCheckBox2Json("excludeHtmlTags"),name:$("#"+crawlRules.v.crawlRulesForm).find("#name").val(),isAbsolute:x,absoluteUrlRegex:r,absoluteUrlBase:i,isCantNull:getCheckbox(crawlRules.v.crawlRulesForm,"isCantNull"),unique:getCheckbox(crawlRules.v.crawlRulesForm,"unique"),labelType:$("#"+crawlRules.v.crawlRulesForm).find("#labelType").val(),isOffset:getCheckbox(crawlRules.v.crawlRulesForm,"isOffset"),isPublic:getCheckbox(crawlRules.v.crawlRulesForm,"isPublic"),mergeRules:$("#"+crawlRules.v.crawlRulesForm).find("#mergeRules").val(),textComposition:$("#"+crawlRules.v.crawlRulesForm).find("#textComposition").val(),regexFilter:$("#"+crawlRules.v.crawlRulesForm).find("#regexFilter").val(),dataJavascriptId:$("#"+crawlRules.v.crawlRulesForm).find("#dataJavascriptId").val(),textLen:$("#"+crawlRules.v.crawlRulesForm).find("#textLen").val(),functionExpression:$("#"+crawlRules.v.crawlRulesForm).find("#functionExpression").val(),filterInter:$("#"+crawlRules.v.crawlRulesForm).find("#filterInter").val(),filterPlugin:$("#"+crawlRules.v.crawlRulesForm).find("#filterPlugin").val(),isTemp:getCheckbox(crawlRules.v.crawlRulesForm,"isTemp"),mustContainText:t,cantContainText:b,excludeText:n,replaceText:m,isLoop:getCheckbox(crawlRules.v.crawlRulesForm,"isLoop"),isStartPosition:getCheckbox(crawlRules.v.crawlRulesForm,"isStartPosition"),isFetchUrl:getCheckbox(crawlRules.v.crawlRulesForm,"isFetchUrl"),fetchUrlHttpRequestId:$("#"+crawlRules.v.crawlRulesForm).find("#httpRequestId").val(),fetchUrlHttpRequestParams:$("#"+crawlRules.v.crawlRulesForm).find("#fetchUrlHttpRequestParams").val(),isConvertEncoding:l,convertEncode:z,isRegexMustContainText:h,isRegexCantContainText:B,isRegexExcludeText:k,isRegexReplaceText:j,isDefaultValue:q,defaultValue:y,isDataOrigin:u,dataOrigin:f,isSingleMatch:getCheckbox(crawlRules.v.crawlRulesForm,"isSingleMatch"),isHtmlPreprocess:getCheckbox(crawlRules.v.crawlRulesForm,"isHtmlPreprocess"),loopSplit:$("#"+crawlRules.v.crawlRulesForm).find("#loopSplit").val(),selectAttr:e,fetchUrlAutoExtract:getCheckbox(crawlRules.v.crawlRulesForm,"fetchUrlAutoExtract")};return g},changeSearchMode:function(){var a=getRadio(crawlRules.v.crawlRulesForm,"searchMode");if(a=="regex"){$("#"+crawlRules.v.crawlRulesForm).find("#regexLabel").css("display","block");$("#"+crawlRules.v.crawlRulesForm).find("#selectLabel").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#stringLabel").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#labelLabel").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#autoLabel").css("display","none")}else{if(a=="string"){$("#"+crawlRules.v.crawlRulesForm).find("#stringLabel").css("display","block");$("#"+crawlRules.v.crawlRulesForm).find("#regexLabel").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#selectLabel").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#labelLabel").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#autoLabel").css("display","none")}else{if(a=="xpath"||a=="csspath"||a=="jsonpath"){$("#"+crawlRules.v.crawlRulesForm).find("#stringLabel").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#regexLabel").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#selectLabel").css("display","block");$("#"+crawlRules.v.crawlRulesForm).find("#labelLabel").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#autoLabel").css("display","none")}else{if(a=="label"){$("#"+crawlRules.v.crawlRulesForm).find("#stringLabel").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#regexLabel").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#selectLabel").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#labelLabel").css("display","block");$("#"+crawlRules.v.crawlRulesForm).find("#autoLabel").css("display","none")}else{if(a=="auto"){$("#"+crawlRules.v.crawlRulesForm).find("#stringLabel").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#regexLabel").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#selectLabel").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#labelLabel").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#autoLabel").css("display","block")}}}}}},changeHtmlPreprocess:function(a,b){selectCheckbox(crawlRules.v.crawlRulesForm,"isPublic",a);$("#"+crawlRules.v.crawlRulesForm).find("#isPublic")[0].disabled=a;selectCheckbox(crawlRules.v.crawlRulesForm,"isTemp",a);$("#"+crawlRules.v.crawlRulesForm).find("#isTemp")[0].disabled=a;selectCheckbox(crawlRules.v.crawlRulesForm,"isCantNull",a);$("#"+crawlRules.v.crawlRulesForm).find("#isCantNull")[0].disabled=a;$("#"+crawlRules.v.crawlRulesForm).find("#isOffset")[0].disabled=a;if(b){selectCheckbox(crawlRules.v.crawlRulesForm,"isOffset",false)}},changeOffset:function(c,d){if(c){if($("#"+crawlRules.v.crawlRulesForm).find("#name").val()==""){$("#"+crawlRules.v.crawlRulesForm).find("#name").val(nc.i18n("res.offset"))}selectRadio(crawlRules.v.crawlRulesForm,"searchMode","regex")}else{var e=$("#"+crawlRules.v.crawlRulesForm).find("#id").val();var b=crawlRules.v.jsonData;for(var a in b){if(isNaN(a)){continue}if(b[a]["id"]==e){selectRadio(crawlRules.v.crawlRulesForm,"searchMode",b[a]["searchMode"]);break}}}$("#"+crawlRules.v.crawlRulesForm).find("#isHtmlPreprocess")[0].disabled=c;$("#"+crawlRules.v.crawlRulesForm).find("#isCantNull")[0].disabled=c;$("#"+crawlRules.v.crawlRulesForm).find("#isTemp")[0].disabled=c;if(d){selectCheckbox(crawlRules.v.crawlRulesForm,"isHtmlPreprocess",false);selectCheckbox(crawlRules.v.crawlRulesForm,"isCantNull",false);selectCheckbox(crawlRules.v.crawlRulesForm,"isTemp",false)}crawlRules.fn.changeSearchMode();crawlRules.fn.changeDisabled()},changeDisabled:function(){var f=$("#"+crawlRules.v.crawlRulesForm).find("#isOffset").attr("checked");var b=$("#"+crawlRules.v.crawlRulesForm).find("#isDataOrigin").attr("checked");var h=$("#"+crawlRules.v.crawlRulesForm).find(":radio[name=searchMode]");for(var d=0,a=h.length;d<a;d++){if(h[d].value=="string"){h[d].disabled=f}else{if(h[d].value=="xpath"||h[d].value=="csspath"||h[d].value=="jsonpath"||h[d].value=="label"){var e=(f||b);if(e){var g=getRadio(crawlRules.v.crawlRulesForm,"searchMode");if(g=="xpath"||g=="csspath"||g=="jsonpath"||g=="label"){selectRadio(crawlRules.v.crawlRulesForm,"searchMode","regex")}}h[d].disabled=e}}}},changeOption:function(c){if(c.checked){$("#"+crawlRules.v.crawlRulesForm).find("#"+c.id+"_option").css("display","block")}else{$("#"+crawlRules.v.crawlRulesForm).find("#"+c.id+"_option").css("display","none")}$("#"+crawlRules.v.tableId).find("#optionTable tr:visible:odd").css("background","#FFFFFF");$("#"+crawlRules.v.tableId).find("#optionTable tr:visible:even").css("background","rgb(247, 247, 247)");crawlRules.fn.changeDisabled();if(c.id=="isDataOrigin"){var a=$("#"+crawlRules.v.crawlRulesForm).find("#isDataOrigin").attr("checked");if(a){var b=$("#"+crawlRules.v.crawlRulesForm).find("#dataOrigin").val();crawlRules.fn.changeDataOrigin(b)}else{crawlRules.fn.changeDataOrigin("")}}},changeDataOrigin:function(a){if(a=="#DATAORIGIN_LABEL"){$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabelOption").css("display","block");$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabelOption").find(".header").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabelOption").find(".label").css("display","block")}else{if(a=="#DATAORIGIN_HEADER"||a=="#DATAORIGIN_COOKIE"){$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabelOption").css("display","block");$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabelOption").find(".label").css("display","none");$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabelOption").find(".header").css("display","block")}else{$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabelOption").css("display","none")}}},show:function(h){var d=$("#"+crawlRules.v.crawlRulesForm).find("#name").val();var f=$("#"+crawlRules.v.crawlRulesForm).find("#startString").val();var g=$("#"+crawlRules.v.crawlRulesForm).find("#endString").val();var c=$("#"+crawlRules.v.crawlRulesForm).find("#labelType").val();var b=getCheckbox(crawlRules.v.crawlRulesForm,"isDataOrigin");var e=$("#"+crawlRules.v.crawlRulesForm).find("#dataOrigin").val();var a=$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabel").val();crawlRules.fn.addRow(h,d,f,g,c,b,e,a)},selectAll:function(e,g,d){var f=$("#"+g).find(":checkbox[name="+d+"]");for(var b=0,a=f.length;b<a;b++){f[b].checked=e.checked}},sortRules:function(a,d){var c="";if(a=="2"){c="pageLabelTabel"}else{c="crawlLabelTabel"}var b=$("#"+crawlRules.v.tableId).find("#"+c).find("#sortable").sortable("toArray");jsonrpc.crawlRulesService.move(function(e,f,g){if(f){return}if(!e){$("#"+crawlRules.v.tableId).find("#"+c).find("#sortable").sortable("cancel");return}$("#"+crawlRules.v.tableId).find("#"+c).find("#sortable>li").each(function(h){$(this).find(".left span").text(h+1+".")});$("#"+crawlRules.v.tableId).find("#"+c).find("li:odd").css("background","rgb(248, 248, 248)");$("#"+crawlRules.v.tableId).find("#"+c).find("li:even").css("background","rgb(255, 255, 255)")},pageRules.v.webCrawlerId,pageRules.v.siteId,crawlRules.v.rulesVerId,b,a)},updateRow:function(e,c){var b=getCheckbox(crawlRules.v.crawlRulesForm,"isDataOrigin");var d=$("#"+crawlRules.v.crawlRulesForm).find("#dataOrigin").val();var a=$("#"+crawlRules.v.crawlRulesForm).find("#valueFromLabel").val();$("#"+crawlRules.v.tableId).find("ul").find("#"+e).find("#rules_name").text(c);$("#"+crawlRules.v.tableId).find("ul").find("#"+e).find("#rules_name").attr("title",c);if(b=="true"&&(d=="#DATAORIGIN_LABEL"||d=="#DATAORIGIN_HEADER"||d=="#DATAORIGIN_COOKIE")){$("#"+crawlRules.v.tableId).find("ul").find("#"+e).find(".parent").addClass("child").removeClass("parent")}else{$("#"+crawlRules.v.tableId).find("ul").find("#"+e).find(".child").addClass("parent").removeClass("child")}},addRow:function(c,b,i,j,a,f,k,h){var d="";var g=1;if(a=="2"){d="pageLabelTabel";crawlRules.v.pageLabelIndex=crawlRules.v.pageLabelIndex+1;g=crawlRules.v.pageLabelIndex}else{d="crawlLabelTabel";crawlRules.v.commonLabelIndex=crawlRules.v.commonLabelIndex+1;g=crawlRules.v.commonLabelIndex}var e='<li id="'+c+'" class="simplehighlight">';if(f=="true"&&(k=="#DATAORIGIN_LABEL"||k=="#DATAORIGIN_HEADER"||k=="#DATAORIGIN_COOKIE")){e+='<span class="child"></span>'}else{e+='<span class="parent"></span>'}e+='<div class="right ui-state-default"><span class="ui-icon ui-icon-trash" title="Delete" onclick="crawlRules.fn.remove('+c+')">Delete</span><span class="ui-icon ui-icon-arrow-4" title="Move">Move</span></div><div class="left"><input type="checkbox" id="rules" name="rules" value = "'+c+'"><span>'+g+'.</span></div><div class="middle"><div class="content" id="rules_name" onclick="crawlRules.fn.editInClickName('+c+');" title="'+b+'">'+b+"</div></div></li>";$("#"+crawlRules.v.tableId).find("#"+d).find("ul").append(e);$("#"+crawlRules.v.tableId).find("#"+d).find("li:odd").css("background","rgb(248, 248, 248)");$("#"+crawlRules.v.tableId).find("#"+d).find("li:even").css("background","rgb(255, 255, 255)");$("#"+crawlRules.v.tableId).find("#"+d).find(".simplehighlight").hover(function(){$(this).addClass("datahighlight")},function(){$(this).removeClass("datahighlight")})},viewCode:function(){var a=$("#"+crawlRules.v.tableId).find("#crawlUrl").val();a=BASE64.encode(a);a=a.split("").reverse().join("");a=encodeURIComponent(a);var b="../tools/code.html?webCrawlerId="+pageRules.v.webCrawlerId+"&siteId="+pageRules.v.siteId+"&u="+a;window.open(b)},xpathTools:function(){var c="http://www.newcrawler.com/static/xpath/mark-min.js";var a="var newcrawler_server_url='http://www.newcrawler.com/'; var script = document.createElement('script'); script.setAttribute('type', 'text/javascript'); script.setAttribute('charset', 'UTF-8'); script.src='"+c+"?'+Math.floor(+new Date/1e7); document.body.appendChild(script);";var d="javascript: (function() { "+a+" })()";var b="<div class='button white'>"+nc.i18n("res.crawler.rules.xpath.button")+"<a title='"+nc.i18n("res.crawler.rules.xpath.title")+"' href=\""+d+'" onclick=\'alert("'+nc.i18n("res.crawler.rules.xpath.alert")+"\");return false;' class='mask-button'>"+nc.i18n("res.crawler.rules.xpath.title")+"</a></div>";document.getElementById("xpath_tools").innerHTML=b},readXPath:function(){var b=$("#"+crawlRules.v.tableId).find("#crawlUrl").val();b=BASE64.encode(b);b=b.split("").reverse().join("");b=encodeURIComponent(b);var a=document.location.href;a=a.substring((a.indexOf("://")+3),a.indexOf("/member/index.html"));a=a.substring(0,a.lastIndexOf("/"));var c="http://"+a+"/member/newcrawler?base64=true&webCrawlerId="+pageRules.v.webCrawlerId+"&siteId="+pageRules.v.siteId+"&rulesVerId="+crawlRules.v.rulesVerId+"&u="+b;window.open(c)},importRules:function(){var a=$("#"+crawlRules.v.tableId).find("#crawlUrl").val();showLoading($("#"+pageRules.v.formId));jsonrpc.crawlRulesService.importRules(function(b,c,d){if(c){removeLoading($("#"+pageRules.v.formId));return}crawlRules.v.pageLabelIndex=0;crawlRules.v.commonLabelIndex=0;if(crawlRules.v.rulesVerId==null||crawlRules.v.rulesVerId===""){crawlRules.fn.queryVer()}else{removeLoading($("#"+pageRules.v.formId));crawlRules.fn.changeRulesVer(crawlRules.v.rulesVerId)}var e=b;if(e){showInfo(nc.i18n("res.import.rules.success"))}else{showInfo(nc.i18n("res.import.rules.failure"))}},pageRules.v.webCrawlerId,pageRules.v.siteId,crawlRules.v.rulesVerId,a)},exportRules:function(){jsonrpc.crawlRulesService.exportRules(function(a,b,c){var d=a;$("#"+crawlRules.v.tableId).find("#crawlUrl").val(d)},pageRules.v.webCrawlerId,pageRules.v.siteId,crawlRules.v.rulesVerId)},addExcludeHtmlTag:function(a){a=replaceHtmlStr(a);var e=false;var g=$("#"+crawlRules.v.crawlRulesForm).find("input[name=excludeHtmlTags]");for(var c=0,f=g.length;c<f;c++){var d=replaceHtmlStr(g[c].value);if(a==d){g[c].checked=true;e=true;break}}if(!e){var b='<li><input name="excludeHtmlTags" type="checkbox" id="excludeHtmlTags" value="'+a+'" checked="checked" >'+a+"</li>";$(b).appendTo("#"+crawlRules.v.crawlRulesForm+" #excludeHtmlTagsDiv ul")}if(e){showInfo(nc.i18n("res.rules.isExist"));return false}return true},initExcludeHtmlTags:function(htmlTagsJson){var excludeHtmlTags=$("#"+crawlRules.v.crawlRulesForm).find("input[name=excludeHtmlTags]");for(var i=0,len=excludeHtmlTags.length;i<len;i++){excludeHtmlTags[i].checked=false}if(htmlTagsJson==null||htmlTagsJson==""){return}var htmlTagsJsonJsonObj=eval(htmlTagsJson);for(var i=0,len=htmlTagsJsonJsonObj.length;i<len;i++){var htmlTag=htmlTagsJsonJsonObj[i];htmlTag=replaceHtmlStr(htmlTag);var isExist=false;for(var j=0,jLen=excludeHtmlTags.length;j<jLen;j++){var tempTag=replaceHtmlStr(excludeHtmlTags[j].value);if(htmlTag==tempTag){excludeHtmlTags[j].checked=true;isExist=true;break}}if(!isExist){var label='<li><input name="excludeHtmlTags" type="checkbox" id="excludeHtmlTags" value="'+htmlTag+'" checked="checked" >'+htmlTag+"</li>";$(label).appendTo("#"+crawlRules.v.crawlRulesForm+" #excludeHtmlTagsDiv ul")}}return isExist},addTextLabel:function(b,f){var e=false;$("#"+crawlRules.v.crawlRulesForm).find("#"+b+"Div").find("ul li a").each(function(){var g=$(this).text();if(g==f){e=true;return}});if(e){showInfo(nc.i18n("res.rules.isExist.text"));return false}f=replaceHtmlStr(f);var a="#"+crawlRules.v.crawlRulesForm+" #"+b+"Div ul";var d='<li><a href="javascript:void(0)" onclick="crawlRules.fn.'+b+'AddBox(this)" title="'+f+'">'+f+'</a><span class="ui-state-default" style="border: none"><span class="ui-icon ui-icon-close" style="float: left; cursor: pointer;">Close</span><span class="ui-icon ui-icon-arrow-4" style="float: left; cursor: move;">Move</span></span></li>';$(d).appendTo(a);var c="#"+crawlRules.v.crawlRulesForm+" #"+b+"Div ul li span.ui-icon-close";$(c).click(function(){$(this).parent().parent().remove();return false});$("#"+crawlRules.v.tableId).find("#sortDiv").find(".sortable").sortable({handle:".ui-icon-arrow-4",update:function(g,h){}}).disableSelection()},initTextLabels:function(j,g){var a="#"+crawlRules.v.crawlRulesForm+" #"+j+"Div ul";$(a).find("li:not(.notRemove)").remove();if(g==null||g==""){return}var e=false;var f="#"+crawlRules.v.crawlRulesForm+" #"+j+"Div ul li a";for(var c=0,d=g.length;c<d;c++){var k=replaceHtmlStr(g[c]);$(f).each(function(){var i=$(this).text();if(k==i){e=true;return}});if(!e){var h='<li><a href="javascript:void(0)" onclick="crawlRules.fn.'+j+'AddBox(this)" title="'+k+'">'+k+'</a><span class="ui-state-default" style="border: none"><span class="ui-icon ui-icon-close" style="float: left; cursor: pointer;">Close</span><span class="ui-icon ui-icon-arrow-4" style="float: left; cursor: move;">Move</span><span></li>';$(h).appendTo(a)}}var b="#"+crawlRules.v.crawlRulesForm+" #"+j+"Div ul li span.ui-icon-close";$(b).click(function(){$(this).parent().parent().remove();return false});$("#"+crawlRules.v.tableId).find("#sortDiv").find(".sortable").sortable({handle:".ui-icon-arrow-4",update:function(i,l){}}).disableSelection();return e},initCheckboxByJson:function(jsonString,eleName){var checkboxs=$("#"+crawlRules.v.crawlRulesForm).find("input[name='"+eleName+"']");for(var i=0,len=checkboxs.length;i<len;i++){checkboxs[i].checked=false}if(jsonString==null||jsonString==""){return}var jsonObj=eval(jsonString);for(var i=0,len=jsonObj.length;i<len;i++){var v=jsonObj[i];for(var j=0,jLen=checkboxs.length;j<jLen;j++){if(checkboxs[j].value==v){checkboxs[j].checked=true;break}}}},getCheckBox2Json:function(c){var a=new Array();$("#"+crawlRules.v.crawlRulesForm).find("input[id='"+c+"']").each(function(){if(this.checked){a.push(this.value)}});var b=toJson(a);return b},getTextJson:function(c){var b=new Array();var d="#"+crawlRules.v.crawlRulesForm+" #"+c+" ul li:not(.notRemove) a";$(d).each(function(){var e=$(this).text();b.push(e)});var a=toJson(b);return a},moveRules:function(b,a){jsonrpc.crawlRulesService.move(function(c,d,e){var f=c;if(f){crawlRules.fn.changeRulesVer(crawlRules.v.rulesVerId);$("#"+crawlRules.v.tableId).find("#tr_"+b).addClass("moveRulesBorder")}},pageRules.v.webCrawlerId,pageRules.v.siteId,crawlRules.v.rulesVerId,b,a)},nextMoveTrCommand:function(d,b){var e=$(d).parent().parent();var a=e[0].rowIndex;var c=$("#"+crawlRules.v.crawlRulesForm).find("#"+b+" tr");c.eq(a).insertAfter(c.eq(a+1))},prevMoveTrCommand:function(d,b){var e=$(d).parent().parent();var a=e[0].rowIndex;var c=$("#"+crawlRules.v.crawlRulesForm).find("#"+b+" tr");c.eq(a).insertBefore(c.eq(a-1))},initTable:function(){var a=$("#"+crawlRules.v.crawlRulesForm).find("table[id='sort_table'] tr").get();$.each(a,function(b,d){var e=$(d).find("td input[name='tdIndex']").val();var c=$(d).find("td input[name='sortIndex']").val();$(d).find("td input[name='tdIndex']").val(c)});crawlRules.fn.freshTable()},getSortIndex:function(){var d="";var b=$("#"+crawlRules.v.crawlRulesForm).find(":input[name=sortIndex]");for(var c=0,a=b.length;c<a;c++){if(d===""){d=b[c].value}else{d+=","+b[c].value}}return d},sortTable:function(d){if(d==null||d==""){d=crawlRules.fn.getSortIndex()}var f=d.split(",");var g=$("#"+crawlRules.v.crawlRulesForm).find(":input[name=tdIndex]");for(var c=0,a=g.length;c<a;c++){try{var b=f[c];g[b].value=c}catch(h){}}crawlRules.fn.freshTable()},freshTable:function(){var a=$("#"+crawlRules.v.crawlRulesForm).find("table[id='sort_table'] tr").get();a=a.sort(function(f,d){var e=$(f).find("td input[name='tdIndex']").val();var c=$(d).find("td input[name='tdIndex']").val();var f=Number(e);var d=Number(c);if(f<d){return -1}else{if(f>d){return 1}else{return 0}}});$.each(a,function(b,c){$("#"+crawlRules.v.crawlRulesForm).find("table[id='sort_table']").append(c)})},testRules:function(){var d="";var f=$("#"+crawlRules.v.tableId).find(":checkbox[name=rules]");for(var b=0,a=f.length;b<a;b++){if(f[b].checked){if(d==""){d=f[b].value}else{d+=","+f[b].value}}}$("#"+crawlRules.v.tableId).find("#crawlResult").val(nc.i18n("res.fetch"));$("#tabsview > .ui-layout-content > div.ui-tabs-panel[aria-hidden='false']").animate({scrollTop:$("#tabsview > .ui-layout-content > div.ui-tabs-panel[aria-hidden='false']")[0].scrollHeight},1500);var e=$("#"+crawlRules.v.tableId).find("#crawlUrl").val();jsonrpc.crawlRulesService.crawlTest(function(c,g,h){if(g){return}$("#"+crawlRules.v.tableId).find("#crawlResult").val(c)},pageRules.v.webCrawlerId,pageRules.v.siteId,crawlRules.v.rulesVerId,e,d)},excludeHtmlTagsAddBox:function(){easyDialog.open({container:{header:nc.i18n("res.rules.htmlLabel.title"),content:'<label style="width:120px; text-align:right">'+nc.i18n("res.rules.htmlLabel")+'</label> <input id="htmlTagInput" name="htmlTagInput" size="33" type="text"></input>',yesFn:function(){var a=document.getElementById("htmlTagInput").value;if(a==null||""==a){showInfo(nc.i18n("res.rules.null.htmlLabel"));return false}return crawlRules.fn.addExcludeHtmlTag(a)},noFn:true}})},mustContainTextAddBox:function(b){var a="";if(b!=null){a=replaceHtmlStr($(b).text())}easyDialog.open({container:{header:nc.i18n("res.rules.mustContainText.title"),content:'<label style="width:120px; text-align:right">'+nc.i18n("res.rules.mustContainText")+'</label> <input id="mustContainTextInput" name="mustContainTextInput" size="35" type="text" class="regex" value="'+a+'"></input>',yesFn:function(){var c=document.getElementById("mustContainTextInput").value;if(c==null||""==c){showInfo(nc.i18n("res.rules.null.mustContainText"));return false}if(b!=null){$(b).text(c)}else{crawlRules.fn.addTextLabel("mustContainText",c)}return true},noFn:true}})},cantContainTextAddBox:function(b){var a="";if(b!=null){a=replaceHtmlStr($(b).text())}easyDialog.open({container:{header:nc.i18n("res.rules.cantContainText.title"),content:'<label style="width:120px; text-align:right">'+nc.i18n("res.rules.cantContainText")+'</label> <input id="cantContainTextInput" name="cantContainTextInput" size="35" type="text" class="regex" value="'+a+'"></input>',yesFn:function(){var c=document.getElementById("cantContainTextInput").value;if(c==null||""==c){showInfo(nc.i18n("res.rules.null.cantContainText"));return false}if(b!=null){$(b).text(c)}else{crawlRules.fn.addTextLabel("cantContainText",c)}return true},noFn:true}})},excludeTextAddBox:function(b){var a="";if(b!=null){a=replaceHtmlStr($(b).text())}easyDialog.open({fixed:false,container:{header:nc.i18n("res.rules.excludeText.title"),content:'<label style="width:120px; text-align:right">'+nc.i18n("res.rules.excludeText")+'</label> <input id="excludeTextInput" name="excludeTextInput" size="35" type="text" class="regex" value="'+a+'"></input>',yesFn:function(){var c=document.getElementById("excludeTextInput").value;if(c==null||""==c){showInfo(nc.i18n("res.rules.null.excludeText"));return false}if(b!=null){$(b).text(c)}else{crawlRules.fn.addTextLabel("excludeText",c)}return true},noFn:true}})},replaceTextAddBox:function(c){var a="";var b="";if(c!=null){var d=$(c).text().split(" > ",2);a=replaceHtmlStr(d[0]);b=replaceHtmlStr(d[1])}easyDialog.open({container:{header:nc.i18n("res.rules.replaceText.title"),content:'<div style="margin-bottom: 5px;"><label style="width:120px; text-align:right">'+nc.i18n("res.rules.replaceText.old")+'</label> <input id="replaceTextOldInput" name="replaceTextOldInput" size="33" type="text" class="regex" value="'+a+'"></input></div><div><label style="width:120px; text-align:right">'+nc.i18n("res.rules.replaceText.new")+'</label> <input id="replaceTextNewInput" name="replaceTextNewInput" size="33" type="text" class="regex" value="'+b+'"></input></div>',yesFn:function(){var f=document.getElementById("replaceTextOldInput").value;var g=document.getElementById("replaceTextNewInput").value;if(f==null||""==f){showInfo(nc.i18n("res.rules.null.replaceText.old"));return false}if(g==null){g=""}var e=f+" > "+g;if(c!=null){$(c).text(e)}else{crawlRules.fn.addTextLabel("replaceText",e)}return true},noFn:true}})},changeUrlStatusTextAddBox:function(a){var b="";if(a!=null){b=replaceHtmlStr($(a).text())}easyDialog.open({container:{header:nc.i18n("res.rules.changeUrlStatusText.title"),content:'<label style="width:120px; text-align:right">'+nc.i18n("res.rules.changeUrlStatusText")+'</label> <input id="changeUrlStatusTextInput" name="changeUrlStatusTextInput" size="35" type="text" class="regex" value="'+b+'"></input>',yesFn:function(){var c=document.getElementById("changeUrlStatusTextInput").value;if(c==null||""==c){showInfo(nc.i18n("res.rules.changeUrlStatusText.null"));return false}if(a!=null){$(a).text(c)}else{crawlRules.fn.addTextLabel("changeUrlStatusText",c)}return true},noFn:true}})},sortRulesVer:function(b){var a=$("#"+crawlRules.v.tableId).find("#rulesVersion").find("#sortable").sortable("toArray");jsonrpc.crawlRulesVerService.move(function(c,d,e){if(d){return}if(!c){$("#"+crawlRules.v.tableId).find("#rulesVersion").find("#sortable").sortable("cancel");return}},pageRules.v.webCrawlerId,pageRules.v.siteId,a)},deleteRulesVer:function(a,b){if(!confirm(nc.i18n("res.remove.confirm"))){return}jsonrpc.crawlRulesVerService.remove(function(c,d,f){if(c){var e=$(a).parent().parent().next();if(e.length<1){e=$(a).parent().parent().prev()}if($(a).parent().parent().hasClass("cur")){$("#"+crawlRules.v.tableId).find("#crawlLabelTabel").find("#sortable").empty();$("#"+crawlRules.v.tableId).find("#pageLabelTabel").find("#sortable").empty()}if(e.length>0){crawlRules.fn.changeRulesVer(e.attr("id"))}else{crawlRules.v.rulesVerId=null}$(a).parent().parent().remove();removeSelect(b,"crawlRulesVerId")}else{showInfo(nc.i18n("res.remove.failure"))}},pageRules.v.webCrawlerId,pageRules.v.siteId,b)},addRulesVer:function(e,b){var d='ondblclick="crawlRules.fn.editRulesVersion(this, '+e+')" ';var a='<span class="ui-icon ui-icon-trash" title="Delete" onclick="crawlRules.fn.deleteRulesVer(this, '+e+')">Delete</span>';var c="";if(b=="DEFAULT"){d="";a="";c="margin-right: 19px;"}$("#"+crawlRules.v.tableId).find("#rulesVersion").find("ul").append('<li id="'+e+'" style="cursor: pointer;"><div onclick="crawlRules.fn.changeRulesVer('+e+')" '+d+'  title="'+b+'" lang="CrawlRulesVersion.html">'+b+'</div><span style="float: right;border: none;background: none;cursor: none;" class="ui-state-default">'+a+'<span class="ui-icon ui-icon-arrow-4" style="'+c+'" title="Move">Move</span></span></li>')},changeRulesVer:function(b,a){if(!a){if(b==crawlRules.v.rulesVerIdByEdit){return}}crawlRules.v.rulesVerIdByEdit=b;crawlRules.fn.query(b);crawlRules.v.rulesVerId=b;$("#"+crawlRules.v.tableId).find("#rulesVersion").find("li").removeClass("cur");$("#"+crawlRules.v.tableId).find("#rulesVersion").find("#"+b).addClass("cur")},addRulesVersion:function(a){openConfigBox($(a),function(b){b.find("#id").val("");b.dialog("option","minWidth",600);b.dialog("option","width",600);b.dialog("option","height",330);b.dialog("option","position",{my:"center",at:"center",of:window})})},editRulesVersion:function(a,b){openConfigBox($(a),function(c){c.find("#id").val(crawlRules.v.rulesVerIdByEdit);c.dialog("option","minWidth",600);c.dialog("option","width",600);c.dialog("option","height",330);c.dialog("option","position",{my:"center",at:"center",of:window})})},saveRulesVersionComplete:function(c,b){var a=$("#"+crawlRules.v.tableId).find("#rulesVersion").find("#"+c).length;if(a<1){crawlRules.fn.addRulesVer(c,b)}else{$("#"+crawlRules.v.tableId).find("#rulesVersion").find("#"+c).attr("title",b);$("#"+crawlRules.v.tableId).find("#rulesVersion").find("#"+c).find("div").attr("title",b);$("#"+crawlRules.v.tableId).find("#rulesVersion").find("#"+c).find("div").text(b)}updateSelect(c,b,"crawlRulesVerId")},defaultValueSel:function(a){$("#"+crawlRules.v.crawlRulesForm).find("#defaultValue").val(a)}}};var pageRules={v:{formId:"pageForm",siteJson:null,webCrawlerId:null,siteId:null},fn:{save:function(){var b=$("#"+pageRules.v.formId).find("#nextLinkExpress").val();var c=$("#"+pageRules.v.formId).find("#nextPageMaxTimes").val();var a=$("#"+pageRules.v.formId).find("#nextLinkMatchRules").val();showLoading($("#"+pageRules.v.formId));jsonrpc.crawlRulesService.savePage(function(d,e,f){if(e){return}var g=d;if(g){showInfo(nc.i18n("res.update.success"))}else{showInfo(nc.i18n("res.update.failure"))}if(crawlRules.v.rulesVerId==null||crawlRules.v.rulesVerId===""){crawlRules.fn.queryVer()}else{removeLoading($("#"+pageRules.v.formId))}},pageRules.v.webCrawlerId,pageRules.v.siteId,crawlRules.v.rulesVerId,b,c,a)},nextLink:function(){var d="";var f=$("#"+crawlRules.v.tableId).find(":checkbox[name=rules]");for(var b=0,a=f.length;b<a;b++){if(f[b].checked){if(d==""){d=f[b].value}else{d+=","+f[b].value}}}$("#"+crawlRules.v.tableId).find("#crawlResult").val(nc.i18n("res.fetch"));$("#tabsview > .ui-layout-content > div.ui-tabs-panel[aria-hidden='false']").animate({scrollTop:$("#tabsview > .ui-layout-content > div.ui-tabs-panel[aria-hidden='false']")[0].scrollHeight},1500);var e=$("#"+crawlRules.v.tableId).find("#crawlUrl").val();jsonrpc.crawlRulesService.nextLink(function(c,g,h){if(g){return}$("#"+crawlRules.v.tableId).find("#crawlResult").val(c)},pageRules.v.webCrawlerId,pageRules.v.siteId,crawlRules.v.rulesVerId,e,d)},nextTest:function(){$("#"+crawlRules.v.tableId).find("#crawlResult").val(nc.i18n("res.fetch"));$("#tabsview > .ui-layout-content > div.ui-tabs-panel[aria-hidden='false']").animate({scrollTop:$("#tabsview > .ui-layout-content > div.ui-tabs-panel[aria-hidden='false']")[0].scrollHeight},1500);var a=$("#"+crawlRules.v.tableId).find("#crawlUrl").val();jsonrpc.crawlRulesService.nextTest(function(b,c,d){if(c){return}$("#"+crawlRules.v.tableId).find("#crawlResult").val(b)},pageRules.v.webCrawlerId,pageRules.v.siteId,crawlRules.v.rulesVerId,a)}}};